# 操作系统：段页式存储 & 磁盘管理（重点整理）

> 本章核心：  
> **主存 ↔ 硬盘映射方式 + 地址转换 + 抖动 + 磁盘调度与时间计算**

---

## 一、层次化存储体系（背景）

从快到慢、从小到大：

1. 寄存器（最快，最小）
2. 高速缓存 Cache
3. 主存（内存）
4. 外存（硬盘）

👉 **程序在硬盘上，运行时必须加载到主存**

主存与硬盘之间也存在 **映射与数据交换问题**  
→ 引出 **页式 / 段式 / 段页式存储**

---

## 二、页式存储（Paging）

### 1. 基本思想

- 程序（硬盘）：划分为 **页（Page）**
- 主存（内存）：划分为 **块 / 页框（Frame）**
- **页大小 = 块大小（固定）**
- 页可以装入任意物理块（非连续）

📌 页号、块号都从 **0 开始编号**

---

### 2. 页表（Page Table）

- 功能：记录 **逻辑页号 → 物理块号**
- 用于地址转换

---

### 3. 专业术语对照

| 对象 | 划分单位 |
|---|---|
| 程序 | 页（Page） |
| 内存 | 块 / 页框（Frame） |

---

### 4. 页式存储优缺点

**优点**
- 内存利用率高
- 无外部碎片
- 实现简单（页表）

**缺点**
- 系统开销大
- 可能产生 **抖动（Thrashing）**

---

## 三、页式存储的地址转换（高频必考）

### 1. 地址结构
逻辑地址 = 页号 + 页内偏移
物理地址 = 物理块号 + 页内偏移

👉 **页内偏移量永远不变**

---

### 2. 页内偏移位数计算

- 页面大小 = 4KB  
- 4KB = 2² × 2¹⁰ = **2¹²**
- 👉 页内偏移量 = **12 位**

---

### 3. 地址转换步骤（模板）

1. 根据页大小，确定 **页内偏移位数**
2. 拆分逻辑地址：
   - 高位：页号
   - 低位：页内偏移
3. 页号 → 查页表 → 物理块号
4. **替换页号，其余不动**

---

### 4. 典型例题

- 页面大小：4KB
- 逻辑地址：`2DE6H`

分析：
- 后 12 位：页内偏移 = `DE6`
- 前面：页号 = `2`
- 页号 2 → 物理块号 4

👉 物理地址：`4DE6H`

---

## 四、抖动（Thrashing）

### 1. 抖动产生原因

- 程序页数很多
- 分配的物理块太少
- 频繁缺页 → 大量 I/O

📌 **系统忙于换页，几乎不执行用户程序**

---

### 2. 页面置换相关标志位

| 标志 | 含义 |
|---|---|
| 状态位 | 1 在内存，0 不在 |
| 访问位 | 最近是否被访问 |
| 修改位 | 是否被修改 |

---

### 3. 置换策略原则

- 优先淘汰：  
  **最近未访问 + 未修改** 的页面  
- 基于 **局部性原理**

---

## 五、段式存储（Segmentation）

### 1. 基本思想

- 按 **程序逻辑结构** 划分（函数、模块、数据段）
- 每一段 **大小不同**
- 整段连续存放

---

### 2. 段表（Segment Table）

| 字段 | 含义 |
|---|---|
| 基址 | 段在内存的起始地址 |
| 段长 | 段的长度 |

---

### 3. 逻辑地址结构
逻辑地址 = 段号 + 段内偏移

### 合法性判断规则（必考）

- **段内偏移 < 段长 → 合法**
- 否则 → 非法访问

---

### 4. 段式存储优缺点

**优点**
- 符合程序逻辑
- 共享与保护方便
- 抑制抖动（相关数据一起装入）

**缺点**
- 内存利用率低
- 外部碎片大

---

## 六、段页式存储（Segmentation + Paging）

### 1. 基本思想

1. **先分段（逻辑）**
2. **再分页（固定大小）**

👉 综合两者优点，规避主要缺点

---

### 2. 地址结构
逻辑地址 = 段号 + 页号 + 页内偏移

---

### 3. 地址转换流程

1. 段号 → 查段表 → 页表基址
2. 页号 → 查页表 → 物理块号
3. 拼接页内偏移 → 物理地址

---

### 4. 位数判断题套路

- 段号位数 = n → 最多 2ⁿ 个段
- 页号位数 = m → 每段最多 2ᵐ 页
- 页内偏移位数 = k → 页大小 = 2ᵏ

---

## 七、磁盘管理基础

### 1. 磁盘结构

- 磁片（正反两面）
- 磁道（同心圆）
- 扇区（磁道上的块）
- **柱面**：多个磁片上相同编号的磁道

📌 题目中 **磁道 ≈ 柱面**

---

### 2. 磁盘访问时间（必考公式）
存取时间 =
寻道时间 +
旋转延迟时间 +
传输时间

---

## 八、磁盘调度算法（必考对比）

### 1. 先来先服务（FCFS）

- 按请求到达顺序
- **公平**
- 寻道距离可能很大

---

### 2. 最短寻道时间优先（SSTF）

- 优先处理最近磁道
- **效率高**
- 不公平（可能饥饿）

---

### 3. 扫描算法（SCAN）

- 磁头来回扫描
- 类似电梯

---

### 4. 循环扫描（C-SCAN）

- 单向扫描
- 回到起点再扫

---

## 九、磁盘读写时间计算（重点）

### 非连续存放文件

- 每读一块：
  - 平均跨磁道
  - 寻道 + 延迟 + 传输

📌 常见套路：
单块时间 × 块数

---

## 十、单缓冲区顺序处理（难点）

### 关键规则

- **读入缓冲区 ≠ 处理完成**
- 读：磁盘 → 缓冲区
- 处理：缓冲区 → CPU
- 读和处理 **不能同时进行**

---

### 优化思想

- 合理安排逻辑记录在磁道上的位置
- 实现：
  > 上一块处理完，下一块刚好转到磁头下

---

## 十一、考试建议

- 页式 / 段式 / 段页式：  
  **地址结构 + 位数 + 合法性**
- 磁盘管理：
  **时间公式 + 调度算法对比**
- 单缓冲区题目：
  **不会就跳，别死磕**

---

## 十二、终极速记
页式：固定大小，页表，偏移不变
段式：逻辑划分，段表，先判合法
段页式：段 → 页 → 偏移

磁盘时间 = 寻道 + 延迟 + 传输
SSTF 快但不公平




